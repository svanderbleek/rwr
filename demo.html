<html>
  <body>
    <h2>Term Rewriting</h2>
    <p>Syntax<p>
    <code id="expression">
      ["f",["x", "x"]]
    </code>
    <br>
    <code id="rule1">
      [["f",["x","x"]],["x"]]
    </code>
    <button id="button1">rewrite</button>
    <br>
    <code id="rule2">
      [["x"],["y"]]
    </code>
    <button id="button2">rewrite</button>
    <br>
    <code id="rule3">
      [["f"],["g"]]
    </code>
    <button id="button3">rewrite</button>
    <br>
    <textarea id="out" class="view"></textarea>
  </body>

  <style>
   .view { display: block; width: 100%; }
  </style>

  <script>
    const jsoneq = (a, b) => JSON.stringify(a) == JSON.stringify(b)
    const rewrite = (expression, rule) => {
      if(jsoneq(expression, rule[0])) return rule[1]
      let [app, args] = expression
      if(app && args && args.length) {
        return [rewrite(app, rule), args.map((arg) => rewrite(arg, rule))]
      } else {
        return expression
      }
    }
    let out = document.getElementById("out")
    let write = (expression) => out.innerHTML = JSON.stringify(expression) + "\n"
    let rewrite_rule = (rule) => {
      let expression = document.getElementById("expression").innerHTML
      write(eval("rewrite("+expression+","+rule+")"))
    }
    let button_and_rule = (id) => {
      let button = document.getElementById("button"+id)
      let rule = document.getElementById("rule"+id).innerHTML
      button.addEventListener("click", () => rewrite_rule(rule))
    }
    button_and_rule("1")
    button_and_rule("2")
    button_and_rule("3")
  </script>
</html>
